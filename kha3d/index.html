<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0">
  <title>Kha3D</title>
  <link rel="stylesheet" href="css/standardize.css">
  <link rel="stylesheet" href="css/index.css">
  <script type="text/javascript" src="http://use.typekit.net/vsp8met.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

  <link rel="stylesheet" href="http://luboslenco.com/hljs/styles/github.css">
  <script src="http://luboslenco.com/hljs/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

  <a class="home" href="http://luboslenco.com"><img src="images/l-icon.png" class="logo"></a>
  <a href="#" class="hamburger"><img src="images/hamburger.png"></a>

  <nav class="primary-nav">
  <a href="#home">Home</a>
  <a href="#opening-a-window">1.Opening a window</a>
  <a href="#the-first-triangle">2.The first triangle</a>
  <a href="#matrices">3.Matrices</a>
  <a href="#a-colored-cube">4.A colored cube</a>
  <a href="#a-textured-cube">5.A textured cube</a>
  <a href="#keyboard-and-mouse">6.Keyboard and mouse</a>
  <a href="#model-loading">7.Model loading</a>
	<a href="#basic-shading">8.Basic shading</a>
  </nav>

  <article class="content">

	<section id="home">
	  <h1>Home</h1>
		<p>Following is a set of examples showing how to use modern, cross-platform 3D graphics API provided by <a href="https://github.com/KTXSoftware/Kha">Kha</a>.</p>
    <p>It is meant to be useful if you want to program truly portable 3D graphics in <a href="http://haxe.org">Haxe</a>, and also as a perfect starting point for learning 3D programming from scratch with a super clean API.</p>
    <p>If you have never heard of this Haxe Kha thing, know this - it allows you to do 3D graphics in the most portable and simplistic way, while still being as close to metal as possible. You can learn more <a href="http://tech.ktxsoftware.com/kha/">here</a>.</p>
    <p>We will be closely following excellent <a href="http://opengl-tutorial.org">opengl-tutorial.org</a> for theory parts, but a clean Kha implementation is built for every tutorial. Let's get started!</p>
	</section>

  <section id="opening-a-window">
    <h1>1.Opening a window</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-1-opening-a-window/">Reference</a>)</p>
    
    <p>The reference tutorial is not really needed here since Kha handles this stuff for us perfectly. Let's see how to setup Kha and get a blank screen to show up.</p>
    
    <p>To use Kha we need <a href="http://git-scm.com">git</a> and <a href="https://nodejs.org">node</a>(0.12.0+). Afterwards, open a terminal/command line (preferably in empty directory to keep things clean) and simply do 'git clone --recursive https://github.com/KTXSoftware/Empty' to get empty project.</p>

    <p>Go to 'Sources' directory and open 'Empty.hx'. We will add a rendering function that just clears the screen.</p>
    <p><pre><code class="hx">
package;

import kha.Game;
import kha.Framebuffer;
import kha.Color;

class Empty extends Game {

    public function new() {
        super("Empty");
    }

    override public function render(frame:Framebuffer) {
        // A graphics object which lets us perform 3D operations
        var g = frame.g4;

        // Begin rendering
        g.begin();

        // Clear screen to black
        g.clear(Color.Black);

        // End rendering
        g.end();
    }
}
    </code></pre></p>

    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>
    <p>Now on to building our project. Open terminal/command line in project folder(where project.kha resides). With Kha you can target pretty much every platform out there, but for simplicity let's do HTML5 build. Type 'node Kha/make -t html5' to build and 'node Kha/make --server' to start local server. Open '127.0.0.1:8080' in your browser and black screen will <a href="http://luboslenco.com/kha3d/build/01">show up</a>!</p>
    </section>

  <section id="the-first-triangle">
    <h1>2.The first triangle</h1>
    
    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-2-the-first-triangle/">Reference</a>)</p>
    
    <p>Here comes the most exciting moment of your life - drawing a triangle! The first thing we need to do is define triangle data and a shader program.</p>

    <p><pre><code class="hx">
// An array of 3 vectors representing 3 vertices to form a triangle
static var vertices:Array&lt;Float&gt; = [
   -1.0, -1.0, 0.0, // Bottom-left
    1.0, -1.0, 0.0, // Bottom-right
    0.0,  1.0, 0.0  // Top
];
// Indices for our triangle, these will point to vertices above
static var indices:Array&lt;Int&gt; = [
  0, // Bottom-left
  1, // Bottom-right
  2  // Top
];

var vertexBuffer:VertexBuffer;
var indexBuffer:IndexBuffer;
var program:Program;
    </code></pre></p>

    <p>Proceed to load shaders and link shader program in init() function.</p>

    <p><pre><code class="hx">
// Define vertex structure
var structure = new VertexStructure();
structure.add("pos", VertexData.Float3);

// Save length - we only store position in vertices for now
// Eventually there will be texture coords, normals,...
var structureLength = 3;

// Load shaders - these are located in 'Sources/Shaders' directory
// and Kha includes them automatically
var fragmentShader = new FragmentShader(Loader.the.getShader("simple.frag"));
var vertexShader = new VertexShader(Loader.the.getShader("simple.vert"));

// Link program with fragment and vertex shaders we loaded
program = new Program();
program.setFragmentShader(fragmentShader);
program.setVertexShader(vertexShader);
program.link(structure);
    </code></pre></p>

    <p>Create vertex and index buffers from triangle data we defined.</p>

    <p><pre><code class="hx">
// Create vertex buffer
vertexBuffer = new VertexBuffer(
  Std.int(vertices.length / 3), // Vertex count - 3 floats per vertex
  structure, // Vertex structure
  Usage.StaticUsage // Vertex data will stay the same
);

// Copy vertices to vertex buffer
var vbData = vertexBuffer.lock();
for (i in 0...vbData.length) {
  vbData[i] = vertices[i];
}
vertexBuffer.unlock();

// Create index buffer
indexBuffer = new IndexBuffer(
  indices.length, // 3 indices for our triangle
  Usage.StaticUsage // Index data will stay the same
);

// Copy indices to index buffer
var iData = indexBuffer.lock();
for (i in 0...iData.length) {
  iData[i] = indices[i];
}
indexBuffer.unlock();
    </code></pre></p>

    <p>Moving to render() function, draw triangle on screen!</p>

    <p><pre><code class="hx">
// Bind shader program we want to draw with
g.setProgram(program);
    
// Bind data we want to draw
g.setVertexBuffer(vertexBuffer);
g.setIndexBuffer(indexBuffer);

// Draw!
g.drawIndexedVertices();
    </code></pre></p>

    <p>For shaders, Kha uses GLSL syntax. Shaders are automatically converted based on target system using a tool called <a href="https://github.com/KTXSoftware/krafix">Krafix</a>, meaning we do not have to worry about rewriting them. The vertex shader.</p>

    <p><pre><code class="glsl">
// Input vertex data, different for all executions of this shader
attribute vec3 pos;

void kore() {
  // Just output position
  gl_Position = vec4(pos, 1.0);
}
    </code></pre></p>

    <p>The fragment shader.</p>

    <p><pre><code class="glsl">
void kore() {
  // Just output red color
  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}
    </code></pre></p>

    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>

    <p>Build and run project as mentioned in tutorial 1, and you will be presented with <a href="http://luboslenco.com/kha3d/build/02">this</a>!</p>

    <p><img src="images/tutorial02.png" width="50%"/></p>
  </section>

  <section id="matrices">
    <h1>3.Matrices</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/">Reference</a>)</p>

    <p>This is where the reference tutorial comes in handy. As it points out, this is the most important part if you are just starting out with 3D programming.</p>

    <p><pre><code class="hx">
// Get a handle for our "MVP" uniform
mvpID = program.getConstantLocation("MVP");
    </code></pre></p>

    <p><pre><code class="hx">
// Projection matrix: 45Â° Field of View, 4:3 ratio, 0.1-100 display range
var projection = Matrix4.perspectiveProjection(45.0, 4.0 / 3.0, 0.1, 100.0);

// Camera matrix
var view = Matrix4.lookAt(new Vector3(4, 3, 3), // Position in World Space
              new Vector3(0, 0, 0), // and looks at the origin
              new Vector3(0, 1, 0) // Head is up
);

// Model matrix: an identity matrix (model will be at the origin)
var model = Matrix4.identity();
    </code></pre></p>

    <p><pre><code class="hx">
// Our ModelViewProjection: multiplication of our 3 matrices
// Remember, matrix multiplication is the other way around
mvp = Matrix4.identity();
mvp = mvp.multmat(projection);
mvp = mvp.multmat(view);
mvp = mvp.multmat(model);
    </code></pre></p>

    <p><pre><code class="hx">
// Send our transformation to the currently bound shader, in the "MVP" uniform
g.setMatrix(mvpID, mvp);
    </code></pre></p>

    <p><pre><code class="hx">
// Input vertex data, different for all executions of this shader
attribute vec3 pos;

// Values that stay constant for the whole mesh
uniform mat4 MVP;

void kore() {
  // Output position of the vertex, in clip space : MVP * position
  gl_Position = MVP * vec4(pos, 1.0);
}
    </code></pre></p>

    <p><pre><code class="json">
{
  "format": 2,
  "game": {
    "name": "Empty",
    "width": 640,
    "height": 480,
    "antiAliasingSamples": 2
  },
  "assets": [],
  "rooms": []
}
    </code></pre></p>


    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>

    <p><a href="http://luboslenco.com/kha3d/build/03">this</a></p>

    <p><img src="images/tutorial03.png" width="50%"/></p>
  </section>

  <section id="a-colored-cube">
    <h1>4.A colored cube</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-4-a-colored-cube/">Reference</a>)</p>

    <p><pre><code class="hx">
    // An array of vertices to form a cube
  static var vertices:Array<Float> = [
      -1.0,-1.0,-1.0,  -1.0,-1.0, 1.0,  -1.0, 1.0, 1.0,
     1.0, 1.0,-1.0,  -1.0,-1.0,-1.0,  -1.0, 1.0,-1.0,
     1.0,-1.0, 1.0,  -1.0,-1.0,-1.0,   1.0,-1.0,-1.0,
     1.0, 1.0,-1.0,   1.0,-1.0,-1.0,  -1.0,-1.0,-1.0,
    -1.0,-1.0,-1.0,  -1.0, 1.0, 1.0,  -1.0, 1.0,-1.0,
     1.0,-1.0, 1.0,  -1.0,-1.0, 1.0,  -1.0,-1.0,-1.0,
    -1.0, 1.0, 1.0,  -1.0,-1.0, 1.0,   1.0,-1.0, 1.0,
     1.0, 1.0, 1.0,   1.0,-1.0,-1.0,   1.0, 1.0,-1.0,
     1.0,-1.0,-1.0,   1.0, 1.0, 1.0,   1.0,-1.0, 1.0,
     1.0, 1.0, 1.0,   1.0, 1.0,-1.0,  -1.0, 1.0,-1.0,
     1.0, 1.0, 1.0,  -1.0, 1.0,-1.0,  -1.0, 1.0, 1.0,
     1.0, 1.0, 1.0,  -1.0, 1.0, 1.0,  1.0,-1.0, 1.0
  ];
  // Array of colors for each cube vertex
  static var colors:Array<Float> = [
      0.583, 0.771, 0.014,  0.609, 0.115, 0.436,  0.327, 0.483, 0.844,
    </code></pre></p>

    <p><pre><code class="hx">
// Define vertex structure
var structure = new VertexStructure();
structure.add("pos", VertexData.Float3);
structure.add("col", VertexData.Float3);
// Save length - we store position and color data
var structureLength = 6;
    </code></pre></p>

    <p><pre><code class="hx">
// Copy vertices and colors to vertex buffer
var vbData = vertexBuffer.lock();
for (i in 0...Std.int(vbData.length / structureLength)) {
  vbData[i * structureLength] = vertices[i * 3];
  vbData[i * structureLength + 1] = vertices[i * 3 + 1];
  vbData[i * structureLength + 2] = vertices[i * 3 + 2];
  vbData[i * structureLength + 3] = colors[i * 3];
  vbData[i * structureLength + 4] = colors[i * 3 + 1];
  vbData[i * structureLength + 5] = colors[i * 3 + 2];
}
vertexBuffer.unlock();
    </code></pre></p>

    <p><pre><code class="hx">
// A 'trick' to create indices for a non-indexed vertex data
var indices:Array<Int> = [];
for (i in 0...Std.int(vertices.length / 3)) {
  indices.push(i);
}

// Create index buffer
indexBuffer = new IndexBuffer(
  indices.length, // Number of indices for our cube
  Usage.StaticUsage // Index data will stay the same
);

// Copy indices to index buffer
var iData = indexBuffer.lock();
for (i in 0...iData.length) {
  iData[i] = indices[i];
}
indexBuffer.unlock();
    </code></pre></p>

    <p><pre><code class="hx">
// Set depth mode
g.setDepthMode(true, CompareMode.Less);
    </code></pre></p>


    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>

    <p><a href="http://luboslenco.com/kha3d/build/04">this</a></p>

    <p><img src="images/tutorial04.png" width="50%"/></p>
  </section>

  <section id="a-textured-cube">
    <h1>5.A textured cube</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-5-a-textured-cube/">Reference</a>)</p>


    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>

    <p><a href="http://luboslenco.com/kha3d/build/05">this</a></p>

    <p><img src="images/tutorial05.png" width="50%"/></p>
  </section>

  <section id="keyboard-and-mouse">
    <h1>6.Keyboard and mouse</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-6-keyboard-and-mouse/">Reference</a>)</p>

    
    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>

    <p><a href="http://luboslenco.com/kha3d/build/06">this</a></p>

    <p><img src="images/tutorial06.png" width="50%"/></p>
  </section>

  <section id="model-loading">
    <h1>7.Model loading</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-7-model-loading/">Reference</a>)</p>


    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>

    <p><a href="http://luboslenco.com/kha3d/build/07">this</a></p>

    <p><img src="images/tutorial07.png" width="50%"/></p>
  </section>

  <section id="basic-shading">
    <h1>8.Basic shading</h1>

    <p>(<a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-8-basic-shading/">Reference</a>)</p>

    
    <p>You can access complete sources <a href="https://github.com/luboslenco/kha3d_examples">here</a>.</p>
    
    <p><a href="http://luboslenco.com/kha3d/build/08">this</a></p>

    <p><img src="images/tutorial08.png" width="50%"/></p>
  </section>

	<footer><a href="http://twitter.com/luboslenco">@luboslenco</a> | <a href="https://github.com/luboslenco/kha3d_examples">Contribute</a></footer>
  </article>

  <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="js/index.js"></script>
</body>
</html>
